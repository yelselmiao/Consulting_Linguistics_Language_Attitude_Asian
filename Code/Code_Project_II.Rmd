---
title: "Code_Project_II"
output: github_document
editor_options: 
  chunk_output_type: inline
---

# Setup
```{r Load Package}
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(rstatix))
suppressPackageStartupMessages(library(ggpubr))
suppressPackageStartupMessages(library(rlang))
`%notin%` <- Negate(`%in%`)
knitr::opts_chunk$set(message = FALSE, warning = FALSE)

```

```{r Load Data, warning=FALSE}
source(paste0(here::here(), 
            "/Code/Data_Prep.R"))
```

# Analysis of Socio-demographic Factors
* gender  
* age  
* country of birth (birthplace)  
* grow up province (place participant grew up; it should be country, not province)  
* ethnic group (racial group)  
* number of spoken language (languages spoken)  
* mother tongue (first language)  
* years of studying French  
* French-speaking place that participants used to live n  
* months of living in French-speaking place  
* preferred type of french to learn (preferred variety of French)  
* origin of French teachers  



## Effect of Speaker Accent 


```{r Gender}
# due to statistical power, only female and male are included in the test 
 data %>%
  group_by(gender) %>%
  tally() %>%
  mutate(prop = scales::percent(n/nrow(data)))


data_agg_long  %>%
  filter(gender %in% c('Female', 'Male')) %>%
  group_by(gender, speaker_accent) %>%
  summarise(mu = mean(score, na.rm = TRUE)) %>% 
  ggplot(aes(x=speaker_accent, y=mu,col=gender))+
  geom_point() + 
  geom_line(aes(group = gender)) + 
  theme_bw() + 
  labs(x = 'Accent', y = 'Mean Score') + 
  scale_colour_discrete('Gender') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 


data_agg_long %>%
  filter(gender %in% c('Female', 'Male')) %>%
  ggplot(aes(y = score, x = speaker_accent, fill=gender)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Accent', y = 'Score',fill='Gender') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5))  


data_agg_long %>%
  filter(gender %in% c('Female', 'Male')) %>%
  group_by(speaker_accent) %>% 
  wilcox_test(score ~ gender, alternative = 'two.sided', paired = FALSE)  


data_agg_long %>%
  filter(gender %in% c('Female', 'Male')) %>%
  group_by(speaker_accent) %>% 
  wilcox_test(score ~ gender, alternative = 'less', paired = FALSE)  
```

```{r age, fig.height=3, fig.width=6}
data_agg_long %>%
  ggplot(aes(x = age, y = score)) +
  geom_jitter() +
  geom_smooth(data=subset(data_agg_long,
                          age < 30)) +
  #geom_smooth(method = loess, method.args = list(family = "symmetric")) + 
  facet_grid( ~ speaker_accent) +
  theme_bw() + 
  labs(x = 'Age', y = 'Score') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 


# corr
shapiro.test(data_agg_long$score)
shapiro.test(data_agg_long$age)


data_agg_long %>%
  drop_na(age) %>% 
  group_by(speaker_accent) %>% 
  summarise(pearson_cor = round(cor.test(year_of_french, score, method = 'pearson', exact = FALSE)$estimate,3),
            pearson_p = round(cor.test(year_of_french, score, method = 'pearson', exact = FALSE)$p.value,3),
            )
```




```{r Country of Birth - Canada or not}
data_agg_long %>%
  filter(is.na(born_in_canada) == FALSE) %>%
  group_by(born_in_canada, speaker_accent) %>%
  summarise(mu = mean(score, na.rm = TRUE)) %>% 
  ggplot(aes(x=speaker_accent, y=mu,col=born_in_canada))+
  geom_point() + 
  geom_line(aes(group = born_in_canada)) + 
  theme_bw() + 
  labs(x = 'Accent', y = 'Mean Score') + 
  scale_colour_discrete('Born in Canada') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 

data_agg_long %>%
  filter(is.na(born_in_canada) == FALSE) %>%
  ggplot(aes(y = score, x = speaker_accent, fill=born_in_canada)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Accent', y = 'Score',fill='Born in Canada') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5)) 

data_agg_long %>%
  filter(is.na(born_in_canada) == FALSE) %>%
  group_by(speaker_accent) %>% 
  wilcox_test(score ~ born_in_canada, paired = FALSE)
```

```{r Country of Brith - Continent}

data %>%
  group_by(continent) %>%
  tally()


data_agg_long %>%  
  mutate(continent_cate = ifelse(continent %in% c('Africa', 'Europe', 'America'), 'Africa, Europe, America', continent))  %>% 
  group_by(continent_cate, speaker_accent) %>%
  summarise(mu = mean(score, na.rm = TRUE)) %>% 
  ggplot(aes(x=speaker_accent, y=mu,col=continent_cate))+
  geom_point() + 
  geom_line(aes(group = continent_cate)) + 
  theme_bw() + 
  labs(x = 'Accent', y = 'Mean Score') + 
  scale_colour_discrete('Birthplace') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 

  
data_agg_long %>%  
  mutate(continent_cate = ifelse(continent %in% c('Africa', 'Europe', 'America'), 'Africa, Europe, America', continent))  %>% 
  group_by(continent_cate, speaker_accent) %>%
  ggplot(aes(y = score, x = speaker_accent, fill=continent_cate)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Accent', y = 'Score',fill='Birthplace') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5))       

# KW test         
data_agg_long %>%  
  mutate(continent_cate = ifelse(continent %in% c('Africa', 'Europe', 'America'), 'Africa, Europe, America', continent))  %>%
  group_by(speaker_accent) %>%
  kruskal_test(score ~ continent_cate)  



# post hoc 
L2 <- data_agg_long %>%
  mutate(continent_cate = ifelse(
    continent %in% c('Africa', 'Europe', 'America'),
    'Africa, Europe, America',
    continent
  ))  %>%
  filter(speaker_accent == 'L2')
FSA::dunnTest(score ~ continent_cate, data = L2, method = 'holm')
```






```{r Grew up in Canada - by Province}
data %>%  
  drop_na(grow_up_province)  %>% 
  group_by(grow_up_province) %>% 
  tally()

# I will aggregate Ontario (4), Quebec (2), and Saskatchewan (2) 



data_agg_long %>%
  drop_na(grow_up_province) %>% 
  mutate(grow_up_province_cate  = ifelse(grow_up_province %in% c('Ontario', 'Quebec', 'Saskatchewan'), 'Ontario, Quebec, or Saskatchewan', ifelse(grow_up_province == 'BC', 'BC', 'Alberta'))) %>%  
  group_by(grow_up_province_cate, speaker_accent) %>%
  summarise(mu = mean(score, na.rm = TRUE)) %>% 
  ggplot(aes(x=speaker_accent, y=mu,col=grow_up_province_cate))+
  geom_point() + 
  geom_line(aes(group = grow_up_province_cate)) + 
  theme_bw() + 
  labs(x = 'Accent', y = 'Mean Score') + 
  scale_colour_discrete('Grow up Province') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 

data_agg_long %>%
  drop_na(grow_up_province) %>% 
  mutate(grow_up_province_cate  = ifelse(grow_up_province %in% c('Ontario', 'Quebec', 'Saskatchewan'), 'Ontario, Quebec, or Saskatchewan', ifelse(grow_up_province == 'BC', 'BC', 'Alberta'))) %>%  
  ggplot(aes(y = score, x = speaker_accent, fill=grow_up_province_cate)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Accent', y = 'Score',fill='Grow up Province') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5)) 


# KW test         
data_agg_long %>%  
  drop_na(grow_up_province) %>% 
  mutate(grow_up_province_cate  = ifelse(grow_up_province %in% c('Ontario', 'Quebec', 'Saskatchewan'), 'Ontario, Quebec, or Saskatchewan', ifelse(grow_up_province == 'BC', 'BC', 'Alberta'))) %>%  
  group_by(speaker_accent) %>%
  kruskal_test(score ~ grow_up_province_cate)  
```


```{r Ethnic group}
data %>%  
  group_by(ethnic_group_cate) %>% 
  tally()

data %>%  
  group_by(ethnic_group_Asian_or_not) %>% 
  tally()

##################### Asian, Latino or Black, Mixed, WHite
data_agg_long %>%
  drop_na(ethnic_group) %>% 
  group_by(ethnic_group_cate, speaker_accent) %>%
  summarise(mu = mean(score, na.rm = TRUE)) %>% 
  ggplot(aes(x=speaker_accent, y=mu,col=ethnic_group_cate))+
  geom_point() + 
  geom_line(aes(group = ethnic_group_cate)) + 
  theme_bw() + 
  labs(x = 'Accent', y = 'Mean Score') + 
  scale_colour_discrete('Racial Group of Participants') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 




data_agg_long %>%
  drop_na(ethnic_group) %>% 
  ggplot(aes(y = score, x = speaker_accent, fill=ethnic_group_cate)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Accent', y = 'Score',fill='Racial Group of Participants') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5)) 


##################### Pure Asian, Mixed Asian, non-Asian 
data_agg_long %>%
  drop_na(ethnic_group) %>% 
  group_by(ethnic_group_Asian_or_not, speaker_accent) %>%
  summarise(mu = mean(score, na.rm = TRUE)) %>% 
  ggplot(aes(x=speaker_accent, y=mu,col=ethnic_group_Asian_or_not))+
  geom_point() + 
  geom_line(aes(group = ethnic_group_Asian_or_not)) + 
  theme_bw() + 
  labs(x = 'Accent', y = 'Mean Score') + 
  scale_colour_discrete('Racial Group of Participants') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 




data_agg_long %>%
  drop_na(ethnic_group) %>% 
  ggplot(aes(y = score, x = speaker_accent, fill=ethnic_group_Asian_or_not)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Accent', y = 'Score',fill='Ethnic Group of Participants') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5)) 



# statistical tests 
# due to the restriction of sample size,  
# 1. pure Asian + mixed Asian vs. Non-Asian
# 2. Pure Asian vs. Non-Asian
# 3. Pure Asian vs.mixed Asian 
# 4. non-asian vs. non-asian


# 1. pure Asian + mixed Asian vs. Non-Asian
data_agg_long %>%  
  mutate(ethic_group_reorder = ifelse(ethnic_group_Asian_or_not == 'Non-Asian', 'Non-Asian', 'Asian')) %>%  
  group_by(speaker_accent) %>% 
  wilcox_test(score ~ ethic_group_reorder, alternative = 'two.sided', paired = FALSE)  %>% 
  select(speaker_accent, statistic, p)


# 2. Pure Asian vs. Non-Asian
data_agg_long %>%  
  drop_na(ethnic_group_Asian_or_not) %>%
  filter(ethnic_group_Asian_or_not != 'Mixed Asian') %>% 
  group_by(speaker_accent) %>%  
  wilcox_test(score ~ ethnic_group_Asian_or_not, alternative = 'less', paired = FALSE)


data_agg_long %>%  
  drop_na(ethnic_group_Asian_or_not) %>%
  filter(ethnic_group_Asian_or_not != 'Mixed Asian') %>% 
  group_by(speaker_accent) %>%  
  wilcox_test(score ~ ethnic_group_Asian_or_not, alternative = 'less', paired = FALSE) # %>% 
  #select(statistic, p)



# since the sample size should be at least 6 for Wilcox 
# 3. Pure Asian vs.mixed Asian 
data_agg_long %>%  
  filter(ethnic_group_Asian_or_not != 'Non-Asian') %>% 
  group_by(speaker_accent) %>%  
  wilcox_test(score ~ ethnic_group_Asian_or_not, alternative = 'two.sided', paired = FALSE)  %>% 
  select(statistic, p)

data_agg_long %>%  
  filter(ethnic_group_Asian_or_not != 'Non-Asian') %>% 
  group_by(speaker_accent) %>%  
  wilcox_test(score ~ ethnic_group_Asian_or_not, alternative = 'less', paired = FALSE)  

   

# 4. Mixed asian vs. non-asian 

data_agg_long %>%  
  filter(ethnic_group_Asian_or_not != "Pure Asian") %>% 
  group_by(speaker_accent) %>%  
  wilcox_test(score ~ ethnic_group_Asian_or_not, alternative = 'two.sided', paired = FALSE) %>% 
  select(statistic, p)


data_agg_long %>%  
  filter(ethnic_group_Asian_or_not != "Pure Asian") %>% 
  group_by(speaker_accent) %>%  
  wilcox_test(score ~ ethnic_group_Asian_or_not, alternative = 'less', paired = FALSE) 
```


```{r Languages spoken, fig.height = 3.5, fig.width = 6}
data %>% 
  group_by(num_of_language) %>% 
  tally()

data_agg_long %>%
  mutate(num_of_language = as.numeric(num_of_language)) %>%  
  ggplot(aes(x = num_of_language, y = score)) +
  geom_jitter() +
  scale_x_continuous(breaks = seq(0, 5, by = 1)) + 
  geom_smooth(method = lm) +
  facet_grid( ~ speaker_accent) +
  theme_bw() + 
  labs(x = 'Number of Languages Spoken', y = 'Score') + 
  scale_colour_discrete('Number of Language(s) Spoken') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10))


# treat num_of_language as rank
data_agg_long %>% 
  drop_na(num_of_language) %>% 
   mutate(num_of_language = as.numeric(num_of_language)) %>% 
   group_by(speaker_accent) %>% 
   summarise(spear_cor = round(cor(score, num_of_language, method = 'spearman'),3),
             spear_p_value = round(cor.test(score, num_of_language, method = 'spearman', exact = FALSE)$p.value,3))
```

```{r Monther Tongue - TBD}
data %>% 
  group_by(mother_tongue) %>% 
  tally()
```


```{r Year of Studying French, fig.height = 3.5, fig.width = 6}
data %>% 
  group_by(year_interval) %>% 
  tally()

# viz
data_agg_long %>%
  mutate(year_of_french = as.numeric(year_of_french)) %>% 
  ggplot(aes(x = year_of_french, y = score)) +
  geom_jitter() +
  geom_smooth(method = 'glm') +
  facet_grid( ~ speaker_accent) +
  theme_bw() + 
  labs(x = 'Years of Learning French', y = 'Score') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 


# corr
shapiro.test(data$score)


data_agg_long %>%
  mutate(year_of_french = as.numeric(year_of_french)) %>% 
  group_by(speaker_accent) %>% 
  summarise(pearson_cor = round(cor.test(year_of_french, score, method = 'pearson', exact = FALSE)$estimate,3),
            pearson_p = round(cor.test(year_of_french, score, method = 'pearson', exact = FALSE)$p.value,3),
            )

# encode year interval into rank
data_agg_long %>% 
  drop_na(year_interval) %>% 
  mutate(
    study_year_group_encoded = case_when(
      year_interval == "0-5" ~ 1,
      year_interval == "5-10" ~2,
      year_interval == "10-15" ~ 3,
      year_interval == "15+" ~ 4
    )
  ) %>%  
  group_by(speaker_accent) %>% 
  summarise(spear_cor = round(cor(score, num_of_language, method = 'spearman',use="pairwise.complete.obs"),3),
             spear_p_value = round(cor.test(score, num_of_language, method = 'spearman', exact = FALSE)$p.value,3))
```


```{r French-spkeaing Place}
data %>% 
  group_by(french_speaking_place_cate) %>% 
  tally()

data_agg_long %>%
  group_by(french_speaking_place_cate, speaker_accent) %>%
  summarise(mu = mean(score, na.rm = TRUE)) %>% 
  ggplot(aes(x=speaker_accent, y=mu,col=french_speaking_place_cate))+
  geom_point() + 
  geom_line(aes(group = french_speaking_place_cate)) + 
  theme_bw() + 
  labs(x = 'Accent', y = 'Mean Score') + 
  scale_colour_discrete('French-speaking Place') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 

data_agg_long %>%
  ggplot(aes(y = score, x = speaker_accent, fill=french_speaking_place_cate)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Accent', y = 'Score',fill='French-speaking Place') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5)) 


# KW 
data_agg_long %>%  
  group_by(speaker_accent) %>%
  kruskal_test(score ~ french_speaking_place_cate) %>% 
  select(speaker_accent, statistic, p)
```


```{r Months of living in French-speaking Place}
data %>% 
  group_by(month_live_in_fr_env) %>% 
  tally()


# due to the sample size, we will combine the group of 1-3 years, 4-6 years, and 7 - 12
data_agg_long %>%  
  mutate(month_live_in_fr_cate = case_when(month_live_in_fr_env %in% c('1 - 3', '4 - 6', '7 - 12')~'1 - 12',
                                           month_live_in_fr_env == '> 12' ~ '> 12', 
                                           month_live_in_fr_env == '< 1' ~ '< 1')) %>% 
  mutate(month_live_in_fr_encode = case_when(month_live_in_fr_cate == '< 1' ~ 1, 
                                             month_live_in_fr_cate == '1 - 12' ~ 2, 
                                             month_live_in_fr_cate == '> 12' ~ 3)) %>%  
  drop_na(month_live_in_fr_encode) %>%  
  group_by(speaker_accent) %>%
  summarise(spear_cor = round(cor(score, month_live_in_fr_encode, method = 'spearman',use="pairwise.complete.obs"),3),
             spear_p_value = round(cor.test(score, month_live_in_fr_encode, method = 'spearman', exact = FALSE)$p.value,3))


# no correlation 


data_agg_long %>%  
  mutate(month_live_in_fr_cate = case_when(month_live_in_fr_env %in% c('1 - 3', '4 - 6', '7 - 12')~'1 - 12',
                                           month_live_in_fr_env == '> 12' ~ '> 12', 
                                           month_live_in_fr_env == '< 1' ~ '< 1')) %>% 
  group_by(speaker_accent) %>%
  kruskal_test(score ~ month_live_in_fr_env) 
```



```{r Preferred Variety of French}
data %>% 
  group_by(pref_french) %>% 
  tally()


data %>% 
  filter(pref_french == 'Other variety of French, please specify:' | is.na(pref_french) == TRUE) %>% 
  select(pref_french_other)



data_agg_long %>%
  filter(!pref_french == 'Other variety of French, please specify:' & !is.na(pref_french) == TRUE) %>% 
  group_by(pref_french, speaker_accent) %>%
  summarise(mu = mean(score, na.rm = TRUE)) %>% 
  ggplot(aes(x=speaker_accent, y=mu,col=pref_french))+
  geom_point() + 
  geom_line(aes(group = pref_french)) + 
  theme_bw() + 
  labs(x = 'Accent', y = 'Mean Score') + 
  scale_colour_discrete('Preferred Variety of French') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 




data_agg_long %>%
  filter(!pref_french == 'Other variety of French, please specify:' & !is.na(pref_french) == TRUE) %>% 
  ggplot(aes(y = score, x = speaker_accent, fill=pref_french)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Accent', y = 'Score',fill='Preferred Variety of French') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5)) 


# KW test         
data_agg_long %>%  
  filter(!pref_french == 'Other variety of French, please specify:' & !is.na(pref_french) == TRUE) %>% 
  group_by(speaker_accent) %>%
  kruskal_test(score ~ pref_french)  %>% 
  select(speaker_accent, statistic, p)


# try ANOVA


```
```{r Origin of French Teachers}
data %>% 
  group_by(teacher_origin) %>% 
  tally()


levels(data_agg_long$teacher_origin) <- c("France", "Other", 'Quebec')


data_agg_long %>%
  drop_na(teacher_origin) %>%
  group_by(teacher_origin, speaker_accent) %>%
  summarise(mu = mean(score, na.rm = TRUE)) %>% 
  ggplot(aes(x=speaker_accent, y=mu,col=teacher_origin))+
  geom_point() + 
  geom_line(aes(group = teacher_origin)) + 
  theme_bw() + 
  labs(x = 'Accent', y = 'Mean Score') + 
  scale_colour_discrete('Origin of French Teacher') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 



data_agg_long %>%
  drop_na(teacher_origin) %>%
  ggplot(aes(y = score, x = speaker_accent, fill=teacher_origin)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Accent', y = 'Score',fill='Origin of French Teacher') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5)) 





data_agg_long %>%  
  drop_na(teacher_origin) %>% 
  group_by(speaker_accent) %>%
  kruskal_test(score ~ teacher_origin)  %>% 
  select(speaker_accent, statistic, p)


African <- data_agg_long %>%
  filter(speaker_accent == 'African')
FSA::dunnTest(score ~ teacher_origin, data = African, method = 'holm')



```



# Effect of Speaker Race

## Comparison of Language Attitudes across each factor level within one speaker race group



### Asian


```{r Gender/contient of birth/grow up province - Viz, fig.height=2, fig.width=6}
speaker_race_gender <- data_agg_long %>%
  filter(gender %in% c('Female', 'Male')) %>%
  ggplot(aes(y = score, x = speaker_race, fill=gender)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Race', y = 'Score',fill='Gender') + 
  ggtitle('Gender') + 
  theme(axis.title.x = element_text(size = 15,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 15,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=15),
        axis.text.y = element_text(size = 15),
        axis.text.x= element_text(size = 15, hjust = 0.5), 
        title = element_text(size = 15,face = 'bold'), 
        legend.text=element_text(size=15))   


speaker_race_continent <- data_agg_long %>%
  mutate(continent_cate = ifelse(continent %in% c('Africa', 'Europe', 'America'), 'Africa, Europe, America', continent))  %>%
  ggplot(aes(y = score, x = speaker_race, fill=continent_cate)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Race', y = 'Score',fill='Continent/Country of Birth') + 
  ggtitle('Continent/Country of Birth') + 
  theme(axis.title.x = element_text(size = 15,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 15,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=15),
        axis.text.y = element_text(size = 15),
        axis.text.x= element_text(size = 15, hjust = 0.5), 
        title = element_text(size = 15,face = 'bold'), 
        legend.text=element_text(size=15)) 


speaker_race_born_in_canada <- data_agg_long %>%
  filter(is.na(born_in_canada) == FALSE) %>%
  ggplot(aes(y = score, x = speaker_race, fill=born_in_canada)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Race', y = 'Score',fill='Born in Canada') + 
  ggtitle('If Particiapnts Were Born in Canada') + 
  theme(axis.title.x = element_text(size = 15,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 15,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=15),
        axis.text.y = element_text(size = 15),
        axis.text.x= element_text(size = 15, hjust = 0.5), 
        title = element_text(size = 15,face = 'bold'), 
        legend.text=element_text(size=15)) 

speaker_race_grow_up_province <- data_agg_long %>%
   drop_na(grow_up_province) %>%
  mutate(
    grow_up_province_cate  = ifelse(
      grow_up_province %in% c('Ontario', 'Quebec', 'Saskatchewan'),
      'Ontario, Quebec, or Saskatchewan',
      ifelse(grow_up_province == 'BC', 'British Columbia', 'Alberta')
    )) %>% 
  ggplot(aes(y = score, x = speaker_race, fill=grow_up_province_cate)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Race', y = 'Score',fill='Grow up Province') + 
  ggtitle('Grow up Province') + 
  theme(axis.title.x = element_text(size = 15,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 15,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=15),
        axis.text.y = element_text(size = 15),
        axis.text.x= element_text(size = 15, hjust = 0.5), 
        title = element_text(size = 15,face = 'bold'), 
        legend.text=element_text(size=15)) 



# ggarrange(speaker_race_gender, speaker_race_continent + rremove("x.text"), 
#           hjust=-0.8,
#           ncol = 2, nrow = 1)
# 
# 
# ggarrange(speaker_race_born_in_canada, speaker_race_grow_up_province + rremove("x.text"), 
#           hjust=-0.8,
#           ncol = 2, nrow = 1)


speaker_race_gender
speaker_race_continent
speaker_race_born_in_canada
speaker_race_grow_up_province
```


```{r Gender/contient of birth/grow up province - Test}
# Gender
data_agg_long %>%
  filter(speaker_race == 'asian') %>%
  filter(gender %in% c('Female', 'Male')) %>%
  wilcox_test(score ~ gender, alternative = 'two.sided', paired = FALSE)


# continent of birth
data_agg_long %>%  
  filter(speaker_race == 'asian') %>%
  mutate(continent_cate = ifelse(continent %in% c('Africa', 'Europe', 'America'), 'Africa, Europe, America', continent))  %>%
  kruskal_test(score ~ continent_cate)  


# born in Canada
data_agg_long %>%
  filter(speaker_race == 'asian') %>%
  filter(is.na(born_in_canada) == FALSE) %>%
  wilcox_test(score ~ born_in_canada,
              alternative = 'two.sided',
              paired = FALSE)  


# Grow up Province
data_agg_long %>%
  filter(speaker_race == 'asian') %>%
  drop_na(grow_up_province) %>%
  mutate(
    grow_up_province_cate  = ifelse(
      grow_up_province %in% c('Ontario', 'Quebec', 'Saskatchewan'),
      'Ontario, Quebec, or Saskatchewan',
      ifelse(grow_up_province == 'BC', 'BC', 'Alberta')
    )
  ) %>%
  kruskal_test(score ~ grow_up_province_cate)  


# 
```


```{r fig.height=4, fig.width=6}

race_viz_1 <- data_agg_long %>%
  filter(speaker_race == 'asian') %>%
  mutate(
    ethic_group_reorder = ifelse(ethnic_group_Asian_or_not == 'Non-Asian', 'Non-Asian', 'Asian')
  ) %>% 
  ggplot(aes(y = score, x = speaker_race, fill=ethic_group_reorder)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Race', y = 'Score',fill='Racial Group') + 
  ggtitle("Asian vs. Non-Asian") + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5)) 

race_viz_2 <- data_agg_long %>%
  filter(speaker_race == 'asian') %>%
  drop_na(ethnic_group_Asian_or_not) %>%
  filter(ethnic_group_Asian_or_not != 'Mixed-race Asian') %>%
  ggplot(aes(y = score, x = speaker_race, fill=ethnic_group_Asian_or_not)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Race', y = 'Score',fill='Racial Group') + 
  ggtitle("Non-Asian vs. Single-race Asian") + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5)) 


race_viz_3 <-  data_agg_long %>%
  filter(speaker_race == 'asian') %>%
  filter(ethnic_group_Asian_or_not != 'Non-Asian') %>%
  ggplot(aes(y = score, x = speaker_race, fill=ethnic_group_Asian_or_not)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Race', y = 'Score',fill='Racial Group') + 
  ggtitle("Mixed-race Asian vs. Single-race Asian") + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5)) 


race_viz_4 <-data_agg_long %>%
   filter(speaker_race == 'asian') %>%
  filter(ethnic_group_Asian_or_not != "Single-race Asian") %>% 
  ggplot(aes(y = score, x = speaker_race, fill=ethnic_group_Asian_or_not)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Race', y = 'Score',fill='Racial Group') + 
  ggtitle("Mixed-race Asian vs. Non-Asian") + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5)) 



ggarrange(race_viz_1, race_viz_2, race_viz_3, race_viz_4 + rremove("x.text"), 
          hjust=-0.8,
          ncol = 2, nrow = 2)
```

```{r}
data_agg_long %>%  
  filter(ethnic_group_Asian_or_not != 'Non-Asian') %>% 
  group_by(speaker_accent) %>%  
  wilcox_test(score ~ ethnic_group_Asian_or_not, alternative = 'two.sided', paired = FALSE)  %>% 
  select(statistic, p)

data_agg_long %>%  
  filter(ethnic_group_Asian_or_not != 'Non-Asian') %>% 
  group_by(speaker_accent) %>%  
  wilcox_test(score ~ ethnic_group_Asian_or_not, alternative = 'less', paired = FALSE)  

   

# 4. Mixed asian vs. non-asian 

data_agg_long %>%  
  filter(ethnic_group_Asian_or_not != "Pure Asian") %>% 
  group_by(speaker_accent) %>%  
  wilcox_test(score ~ ethnic_group_Asian_or_not, alternative = 'two.sided', paired = FALSE) %>% 
  select(statistic, p)


data %>% 
  select(ethnic_group, ethnic_group_Asian_or_not, ethnic_group_cate)

```


```{r Racial Group}

  
# 1. pure Asian + mixed Asian vs. Non-Asian
data_agg_long %>%
  filter(speaker_race == 'asian') %>%
  mutate(
    ethic_group_reorder = ifelse(ethnic_group_Asian_or_not == 'Non-Asian', 'Non-Asian', 'Asian')
  ) %>%
  wilcox_test(score ~ ethic_group_reorder,
              alternative = 'two.sided',
              paired = FALSE)  


# 2. Pure Asian vs. Non-Asian
data_agg_long %>%
  filter(speaker_race == 'asian') %>%
  drop_na(ethnic_group_Asian_or_not) %>%
  filter(ethnic_group_Asian_or_not != 'Mixed Asian') %>%
  wilcox_test(score ~ ethnic_group_Asian_or_not,
              alternative = 'two.sided',
              paired = FALSE)


data_agg_long %>%
  filter(speaker_race == 'asian') %>%
  drop_na(ethnic_group_Asian_or_not) %>%
  filter(ethnic_group_Asian_or_not != 'Mixed Asian') %>%
  wilcox_test(score ~ ethnic_group_Asian_or_not,
              alternative = 'less',
              paired = FALSE) # %>%
#select(statistic, p)



# since the sample size should be at least 6 for Wilcox
# 3. Pure Asian vs.mixed Asian
data_agg_long %>%
  filter(speaker_race == 'asian') %>%
  filter(ethnic_group_Asian_or_not != 'Non-Asian') %>%
  wilcox_test(score ~ ethnic_group_Asian_or_not,
              alternative = 'two.sided',
              paired = FALSE)  

data_agg_long %>%
  filter(speaker_race == 'asian') %>%
  filter(ethnic_group_Asian_or_not != 'Non-Asian') %>%
  wilcox_test(score ~ ethnic_group_Asian_or_not,
              alternative = 'less',
              paired = FALSE)



# 4. Mixed asian vs. non-asian

data_agg_long %>%
  filter(speaker_race == 'asian') %>%
  filter(ethnic_group_Asian_or_not != "Pure Asian") %>%
  wilcox_test(score ~ ethnic_group_Asian_or_not,
              alternative = 'two.sided',
              paired = FALSE) %>%
  select(statistic, p)


data_agg_long %>%
  filter(speaker_race == 'asian') %>%
  filter(ethnic_group_Asian_or_not != "Pure Asian") %>%
  wilcox_test(score ~ ethnic_group_Asian_or_not,
              alternative = 'less',
              paired = FALSE) 
```

```{r French Speaking Place/Preference/Teacher Origin}
# KW 
data_agg_long %>%
  filter(speaker_race == 'asian') %>%
  kruskal_test(score ~ french_speaking_place_cate)


data_agg_long %>%
  filter(speaker_race == 'asian') %>%
  filter(!pref_french == 'Other variety of French, please specify:' &
           !is.na(pref_french) == TRUE) %>%
  kruskal_test(score ~ pref_french)

data_agg_long %>%
  filter(speaker_race == 'asian') %>%
  drop_na(teacher_origin) %>%
  kruskal_test(score ~ teacher_origin)  
```

### White 

```{r Gender/contient of birth/grow up province}
# Gender
data_agg_long %>%
  filter(speaker_race == 'white') %>%
  filter(gender %in% c('Female', 'Male')) %>%
  wilcox_test(score ~ gender, alternative = 'two.sided', paired = FALSE)


# continent of birth 
data_agg_long %>%  
  filter(speaker_race == 'white') %>%
  mutate(continent_cate = ifelse(continent %in% c('Africa', 'Europe', 'America'), 'Africa, Europe, America', continent))  %>%
  kruskal_test(score ~ continent_cate)  


# born in Canada
data_agg_long %>%
  filter(speaker_race == 'white') %>%
  filter(is.na(born_in_canada) == FALSE) %>%
  wilcox_test(score ~ born_in_canada,
              alternative = 'two.sided',
              paired = FALSE)  


# Grow up Province
data_agg_long %>%
  filter(speaker_race == 'white') %>%
  drop_na(grow_up_province) %>%
  mutate(
    grow_up_province_cate  = ifelse(
      grow_up_province %in% c('Ontario', 'Quebec', 'Saskatchewan'),
      'Ontario, Quebec, or Saskatchewan',
      ifelse(grow_up_province == 'BC', 'BC', 'Alberta')
    )
  ) %>%
  kruskal_test(score ~ grow_up_province_cate)  


# 
```

```{r Racial Group}
# 1. pure Asian + mixed Asian vs. Non-Asian
data_agg_long %>%
  filter(speaker_race == 'white') %>%
  mutate(
    ethic_group_reorder = ifelse(ethnic_group_Asian_or_not == 'Non-Asian', 'Non-Asian', 'Asian')
  ) %>%
  wilcox_test(score ~ ethic_group_reorder,
              alternative = 'two.sided',
              paired = FALSE)  


# 2. Pure Asian vs. Non-Asian
data_agg_long %>%
  filter(speaker_race == 'white') %>%
  drop_na(ethnic_group_Asian_or_not) %>%
  filter(ethnic_group_Asian_or_not != 'Mixed Asian') %>%
  wilcox_test(score ~ ethnic_group_Asian_or_not,
              alternative = 'two.sided',
              paired = FALSE)


data_agg_long %>%
  filter(speaker_race == 'white') %>%
  drop_na(ethnic_group_Asian_or_not) %>%
  filter(ethnic_group_Asian_or_not != 'Mixed Asian') %>%
  wilcox_test(score ~ ethnic_group_Asian_or_not,
              alternative = 'less',
              paired = FALSE) # %>%
#select(statistic, p)



# since the sample size should be at least 6 for Wilcox
# 3. Pure Asian vs.mixed Asian
data_agg_long %>%
  filter(speaker_race == 'white') %>%
  filter(ethnic_group_Asian_or_not != 'Non-Asian') %>%
  wilcox_test(score ~ ethnic_group_Asian_or_not,
              alternative = 'two.sided',
              paired = FALSE)  %>%
  select(statistic, p)

data_agg_long %>%
  filter(ethnic_group_Asian_or_not != 'Non-Asian') %>%
  wilcox_test(score ~ ethnic_group_Asian_or_not,
              alternative = 'less',
              paired = FALSE)



# 4. Mixed asian vs. non-asian

data_agg_long %>%
  filter(speaker_race == 'white') %>%
  filter(ethnic_group_Asian_or_not != "Pure Asian") %>%
  wilcox_test(score ~ ethnic_group_Asian_or_not,
              alternative = 'two.sided',
              paired = FALSE) %>%
  select(statistic, p)


data_agg_long %>%
  filter(speaker_race == 'white') %>%
  filter(ethnic_group_Asian_or_not != "Pure Asian") %>%
  wilcox_test(score ~ ethnic_group_Asian_or_not,
              alternative = 'less',
              paired = FALSE) 
```

```{r French Speaking Place/Preference/Teacher Origin}
# KW 
data_agg_long %>%
  filter(speaker_race == 'white') %>%
  kruskal_test(score ~ french_speaking_place_cate)


data_agg_long %>%
  filter(speaker_race == 'white') %>%
  filter(!pref_french == 'Other variety of French, please specify:' &
           !is.na(pref_french) == TRUE) %>%
  kruskal_test(score ~ pref_french)

data_agg_long %>%
  filter(speaker_race == 'white') %>%
  drop_na(teacher_origin) %>%
  kruskal_test(score ~ teacher_origin)  
```

## Comparision of Language Attitudes between two speaker race group within one factor level
```{r Mean by Factor}
(col_of_interest <- names(data_agg_long)[c(4,8, 22, 24, 26:32)])

for (col in col_of_interest){
  mean_by_factor <- factor_mean(data_agg_long, col)
  print(mean_by_factor)
}
```






```{r Two-sample Test by Factor}
for (col in col_of_interest){
  wilcox_res <- factor_ts_test(data_agg_long, col)
  print(wilcox_res)
}
```




gender
age
country of birth (birthplace)
grow up province (place participant grew up; it should be country, not province)
ethnic group (racial group)
number of spoken language (languages spoken)
mother tongue (first language)
years of studying French
French-speaking place that participants used to live n
months of living in French-speaking place
preferred type of french to learn (preferred variety of French)
origin of French teachers





